# üéØ Guide Complet : OVH + Cloudflare Workers ‚Üí Score A+

## üìã Votre Configuration

- ‚úÖ Domaine chez OVH
- ‚úÖ Compte Cloudflare existant
- ‚úÖ Option A : GitHub Pages + Cloudflare Workers
- üéØ Objectif : Score A+ sur securityheaders.com

**Temps total : 20 minutes + attente nameservers (2-24h)**

---

## üöÄ PARTIE 1 : Ajouter votre site √† Cloudflare

### √âtape 1.1 : Se connecter √† Cloudflare

1. Aller sur https://dash.cloudflare.com
2. Se connecter avec votre compte existant

### √âtape 1.2 : Ajouter votre site

1. Sur le dashboard, cliquer sur **"Ajouter un site"** ou **"Add a site"** (bouton bleu en haut √† droite)
2. Entrer votre nom de domaine (exemple : `reddenconnexion.fr`)
3. Cliquer sur **"Ajouter un site"**

### √âtape 1.3 : Choisir le plan Free

1. Cloudflare va afficher les plans disponibles :
   ```
   Free        0 ‚Ç¨/mois     [S√©lectionner]
   Pro        20 ‚Ç¨/mois
   Business  200 ‚Ç¨/mois
   ```
2. Cliquer sur **"S√©lectionner"** sous **Free (0 ‚Ç¨/mois)**
3. Cliquer sur **"Continuer"**

### √âtape 1.4 : Scanner les DNS

Cloudflare va automatiquement scanner vos DNS actuels (√ßa prend 30 secondes)

Vous verrez quelque chose comme :
```
Type    Nom    Contenu                      Proxy
A       @      185.199.108.153             ‚òÅÔ∏è Proxied
CNAME   www    reddenconnexion.github.io   ‚òÅÔ∏è Proxied
```

**Important :** V√©rifier que le nuage orange (‚òÅÔ∏è) est activ√© (Proxied) = Cloudflare est actif

Si tout est bon, cliquer sur **"Continuer"**

---

## üîß PARTIE 2 : Changer les Nameservers chez OVH

### √âtape 2.1 : R√©cup√©rer les nameservers Cloudflare

Cloudflare va afficher une page avec vos **2 nameservers** :

```
Remplacer vos nameservers par :

1Ô∏è‚É£ carter.ns.cloudflare.com
2Ô∏è‚É£ maya.ns.cloudflare.com

(Les noms exacts varient, notez les v√¥tres !)
```

**‚ö†Ô∏è IMPORTANT :** Copiez ces 2 nameservers, vous en aurez besoin !

**Ne fermez PAS cette page Cloudflare**, gardez-la ouverte dans un onglet.

### √âtape 2.2 : Se connecter √† OVH

1. Ouvrir un **nouvel onglet**
2. Aller sur https://www.ovh.com/manager/
3. Se connecter avec votre identifiant OVH

### √âtape 2.3 : Acc√©der √† votre domaine

1. Dans le menu de gauche, cliquer sur **"Noms de domaine"** ou **"Web Cloud"** puis **"Noms de domaine"**
2. Cliquer sur votre domaine (ex: `reddenconnexion.fr`)

Vous arrivez sur la page de gestion de votre domaine.

### √âtape 2.4 : Modifier les serveurs DNS

1. En haut de la page, cliquer sur l'onglet **"Serveurs DNS"**

Vous verrez les serveurs DNS actuels d'OVH, quelque chose comme :
```
dnsXXX.ovh.net
nsXXX.ovh.net
```

2. Cliquer sur le bouton **"Modifier les serveurs DNS"** (√† droite)

3. Une fen√™tre s'ouvre avec 2 options :
   ```
   ‚ö™ Utiliser les serveurs DNS d'OVH
   ‚ö™ Utiliser d'autres serveurs DNS
   ```

4. S√©lectionner **"Utiliser d'autres serveurs DNS"**

5. Vous verrez 2 champs pour entrer les nameservers :
   ```
   Serveur DNS n¬∞1 : [________________]
   Serveur DNS n¬∞2 : [________________]
   ```

6. **Copier-coller** les nameservers Cloudflare (de l'√©tape 2.1) :
   ```
   Serveur DNS n¬∞1 : carter.ns.cloudflare.com
   Serveur DNS n¬∞2 : maya.ns.cloudflare.com
   ```
   (Utilisez VOS nameservers Cloudflare, pas ces exemples !)

7. Cliquer sur **"Appliquer la configuration"**

8. OVH affiche un avertissement :
   ```
   ‚ö†Ô∏è La modification des serveurs DNS peut prendre jusqu'√† 48h
   ```

9. Cliquer sur **"Valider"**

**‚úÖ C'EST FAIT !** Les nameservers sont chang√©s chez OVH.

### √âtape 2.5 : Confirmer √† Cloudflare

1. Retourner sur l'onglet **Cloudflare**
2. En bas de la page, cliquer sur **"Termin√©, v√©rifier les nameservers"**
3. Cloudflare affiche :
   ```
   üîÑ V√©rification en cours...
   Nous v√©rifions que vos nameservers ont √©t√© chang√©s.
   Vous recevrez un email quand ce sera actif (2-24h)
   ```
4. Cliquer sur **"Terminer"**

**‚è±Ô∏è ATTENTE :** Vous allez recevoir un email de Cloudflare dans les 2 √† 24h avec le sujet :
```
"[Votre domaine] est maintenant actif sur Cloudflare"
```

**Pendant ce temps :**
- ‚úÖ Votre site continue de fonctionner normalement
- ‚úÖ Vous pouvez d√©j√† pr√©parer le Worker (Partie 3)

---

## üõ°Ô∏è PARTIE 3 : Cr√©er le Cloudflare Worker (Headers de s√©curit√©)

**‚ö†Ô∏è IMPORTANT :** Attendez de recevoir l'email de confirmation Cloudflare avant de faire cette partie !

Une fois que vous avez re√ßu l'email "Votre domaine est actif sur Cloudflare" :

### √âtape 3.1 : Acc√©der √† Workers

1. Dans le dashboard Cloudflare (https://dash.cloudflare.com)
2. Dans le menu de gauche, cliquer sur **"Workers & Pages"**
3. Cliquer sur **"Create application"** ou **"Cr√©er une application"**
4. Cliquer sur **"Create Worker"** ou **"Cr√©er un Worker"**

### √âtape 3.2 : Nommer le Worker

1. Cloudflare propose un nom al√©atoire (ex: `bitter-sun-1234`)
2. **Renommer en :** `security-headers`
3. Cliquer sur **"Deploy"** ou **"D√©ployer"**

Le Worker est cr√©√© avec un code par d√©faut.

### √âtape 3.3 : Modifier le code du Worker

1. Cliquer sur **"Edit code"** ou **"Modifier le code"** (bouton bleu)
2. Vous arrivez dans l'√©diteur de code

**Vous voyez du code JavaScript existant ‚Üí TOUT SUPPRIMER**

3. **S√©lectionner tout** (Ctrl+A)
4. **Supprimer** (Delete)
5. **Copier-coller ce code COMPLET** :

```javascript
export default {
  async fetch(request, env, ctx) {
    // R√©cup√©rer la r√©ponse originale de GitHub Pages
    const response = await fetch(request);

    // Cr√©er une nouvelle r√©ponse avec les headers de s√©curit√©
    const newResponse = new Response(response.body, response);

    // ========================================
    // HEADERS DE S√âCURIT√â POUR SCORE A+
    // ========================================

    // 1. Content Security Policy (Protection contre XSS)
    newResponse.headers.set(
      'Content-Security-Policy',
      "default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com https://formspree.io; style-src 'self' 'unsafe-inline' https://unpkg.com; img-src 'self' data: https:; font-src 'self'; connect-src 'self' https://formspree.io https://*.tile.openstreetmap.org; frame-ancestors 'none'"
    );

    // 2. X-Frame-Options (Emp√™che le site d'√™tre charg√© dans une iframe)
    newResponse.headers.set('X-Frame-Options', 'DENY');

    // 3. X-Content-Type-Options (Emp√™che le sniffing MIME)
    newResponse.headers.set('X-Content-Type-Options', 'nosniff');

    // 4. Referrer Policy (Politique de referrer stricte)
    newResponse.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');

    // 5. Permissions Policy (Restreint les APIs sensibles)
    newResponse.headers.set(
      'Permissions-Policy',
      'geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=()'
    );

    // 6. Strict-Transport-Security (Force HTTPS - HSTS)
    newResponse.headers.set(
      'Strict-Transport-Security',
      'max-age=31536000; includeSubDomains; preload'
    );

    // Retourner la r√©ponse avec tous les headers de s√©curit√©
    return newResponse;
  },
};
```

6. Cliquer sur **"Save and Deploy"** ou **"Enregistrer et d√©ployer"** (en haut √† droite)

**‚úÖ Worker cr√©√© !** Mais il n'est pas encore actif sur votre site.

### √âtape 3.4 : Configurer une Route (Activer le Worker)

1. Cliquer sur la fl√®che **‚Üê retour** (en haut √† gauche)
2. Vous revenez √† la liste des Workers
3. Cliquer sur votre Worker **`security-headers`**
4. Cliquer sur l'onglet **"Settings"** ou **"Param√®tres"**
5. Descendre jusqu'√† la section **"Triggers"** ou **"D√©clencheurs"**
6. Dans la sous-section **"Routes"**, cliquer sur **"Add route"** ou **"Ajouter une route"**

7. Une fen√™tre s'ouvre :
   ```
   Route : [_____________________]
   Zone  : [S√©lectionner votre site]
   ```

8. **Dans "Route" :** Entrer `votredomaine.com/*`

   **Exemples :**
   ```
   reddenconnexion.fr/*
   ```

   **‚ö†Ô∏è Important :** Remplacez par VOTRE domaine + `/*` √† la fin

9. **Dans "Zone" :** S√©lectionner votre site dans le menu d√©roulant

10. Cliquer sur **"Save"** ou **"Enregistrer"**

**üéâ LE WORKER EST ACTIF !**

---

## ‚úÖ PARTIE 4 : Activer HTTPS et optimisations

### √âtape 4.1 : Configurer SSL/TLS

1. Dans le dashboard Cloudflare, cliquer sur votre site
2. Dans le menu de gauche, cliquer sur **"SSL/TLS"**
3. Dans **"Overview"**, s√©lectionner le mode **"Full"**
   ```
   ‚ö™ Off
   ‚ö™ Flexible
   ‚öôÔ∏è Full          ‚Üê S√©lectionner celui-ci
   ‚ö™ Full (strict)
   ```

### √âtape 4.2 : Activer "Always Use HTTPS"

1. Toujours dans **"SSL/TLS"**, cliquer sur **"Edge Certificates"**
2. Descendre jusqu'√† **"Always Use HTTPS"**
3. **Activer** le bouton (il devient bleu)

### √âtape 4.3 : Activer HSTS

1. Dans la m√™me page, descendre jusqu'√† **"HTTP Strict Transport Security (HSTS)"**
2. Cliquer sur **"Enable HSTS"** ou **"Activer HSTS"**
3. Une fen√™tre s'ouvre avec plusieurs options :
   ```
   Max Age           : [12 mois]
   Include subdomains: ‚úÖ
   Preload           : ‚úÖ
   No-Sniff          : ‚úÖ
   ```
4. Laisser les valeurs par d√©faut
5. Cliquer sur **"Save"** ou **"Enregistrer"**

**‚úÖ CONFIGURATION TERMIN√âE !**

---

## üß™ PARTIE 5 : Tester le Score A+

### √âtape 5.1 : Attendre la propagation

**Attendre 5 minutes** pour que les changements se propagent.

### √âtape 5.2 : Vider le cache du navigateur

1. Ouvrir votre site dans le navigateur
2. Appuyer sur **Ctrl + Shift + R** (ou Cmd + Shift + R sur Mac)
3. Cela force le rechargement complet

### √âtape 5.3 : V√©rifier les headers (optionnel)

**M√©thode navigateur :**
1. Appuyer sur **F12** (outils d√©veloppeur)
2. Aller dans l'onglet **"Network"** ou **"R√©seau"**
3. Rafra√Æchir la page (F5)
4. Cliquer sur la premi√®re ligne (votre page HTML)
5. Aller dans **"Headers"** ou **"En-t√™tes"**
6. Chercher dans **"Response Headers"** :
   ```
   content-security-policy: default-src 'self'; ...
   x-frame-options: DENY
   x-content-type-options: nosniff
   strict-transport-security: max-age=31536000; ...
   ```

Si vous voyez ces headers ‚Üí **√áA FONCTIONNE !** ‚úÖ

### √âtape 5.4 : Tester sur Security Headers

1. Aller sur https://securityheaders.com
2. Entrer votre domaine (ex: `reddenconnexion.fr`)
3. Cliquer sur **"Scan"**

**R√©sultat attendu :**
```
üéâ Score : A+
```

Avec tous les headers en vert :
- ‚úÖ Content-Security-Policy
- ‚úÖ X-Frame-Options
- ‚úÖ X-Content-Type-Options
- ‚úÖ Referrer-Policy
- ‚úÖ Permissions-Policy
- ‚úÖ Strict-Transport-Security

**üéä F√âLICITATIONS ! VOUS AVEZ A+ !**

---

## üìä R√©capitulatif : Qu'avez-vous fait ?

```
AVANT :
Visiteur ‚Üí reddenconnexion.fr ‚Üí GitHub Pages ‚Üí Score F ‚ùå

APR√àS :
Visiteur ‚Üí reddenconnexion.fr
         ‚Üí Cloudflare (+ headers s√©curit√© via Worker)
         ‚Üí GitHub Pages
         ‚Üí Score A+ ‚úÖ
```

**Ce qui a chang√© :**
- ‚úÖ Nameservers OVH ‚Üí Cloudflare (tout le trafic passe par Cloudflare)
- ‚úÖ Worker ajoute 6 headers de s√©curit√©
- ‚úÖ GitHub Pages continue d'h√©berger votre site (rien ne change c√¥t√© code)
- ‚úÖ Bonus : CDN Cloudflare (site plus rapide)
- ‚úÖ Bonus : Protection DDoS gratuite

**Ce qui n'a PAS chang√© :**
- ‚úÖ Votre workflow GitHub (git push, etc.)
- ‚úÖ Votre code
- ‚úÖ Votre domaine
- ‚úÖ L'URL de votre site

---

## üîß D√©pannage

### Je n'ai pas re√ßu l'email de Cloudflare

**D√©lai normal :** 2 √† 24h

**V√©rifier :**
1. V√©rifier les spams
2. Se connecter √† Cloudflare et voir si le site est "Actif"
3. Si apr√®s 48h rien, contacter le support Cloudflare

### Le score reste F apr√®s configuration

**Solutions :**
1. Vider le cache du navigateur (Ctrl+Shift+R)
2. Attendre 5-10 minutes
3. V√©rifier que la route du Worker est bien : `votredomaine.com/*`
4. V√©rifier que le Worker est bien "D√©ploy√©" (pas de brouillon)

### Mon site affiche une erreur 520/522

**Cause :** Probl√®me de connexion Cloudflare ‚Üí GitHub Pages

**Solution :**
1. Aller dans **SSL/TLS** ‚Üí **Overview**
2. Passer en mode **"Flexible"** au lieu de "Full"
3. Attendre 2 minutes
4. Tester le site

### Les headers n'apparaissent pas

**V√©rifier :**
1. Le Worker est bien "Deployed" (pas "Draft")
2. La route existe bien dans "Triggers" ‚Üí "Routes"
3. La route est : `votredomaine.com/*` (avec l'√©toile)
4. Le site Cloudflare est "Active"

---

## üí∞ Co√ªts

**Total : 0‚Ç¨**

Le plan Cloudflare Free inclut :
- ‚úÖ 100 000 requ√™tes Workers/jour (largement suffisant)
- ‚úÖ CDN mondial illimit√©
- ‚úÖ SSL/TLS gratuit
- ‚úÖ Protection DDoS
- ‚úÖ Analytiques basiques

Pour un site d'√©lectricien, vous ne d√©passerez jamais les limites gratuites.

---

## üéØ Checklist Compl√®te

### Phase 1 : Cloudflare + OVH (20 minutes)
- [ ] Ajouter le site √† Cloudflare
- [ ] Choisir plan Free
- [ ] R√©cup√©rer les 2 nameservers Cloudflare
- [ ] Se connecter √† OVH
- [ ] Modifier les serveurs DNS
- [ ] Entrer les nameservers Cloudflare
- [ ] Confirmer √† Cloudflare

### Phase 2 : Attente (2-24h)
- [ ] Recevoir l'email "Votre domaine est actif sur Cloudflare"

### Phase 3 : Worker (10 minutes)
- [ ] Cr√©er un Worker
- [ ] Le nommer `security-headers`
- [ ] Copier-coller le code JavaScript
- [ ] Sauvegarder et d√©ployer
- [ ] Ajouter une route : `votredomaine.com/*`

### Phase 4 : SSL/TLS (5 minutes)
- [ ] Mode SSL : Full
- [ ] Activer "Always Use HTTPS"
- [ ] Activer HSTS

### Phase 5 : Test
- [ ] Attendre 5 minutes
- [ ] Vider cache navigateur
- [ ] Tester sur securityheaders.com
- [ ] **Voir le score A+** üéâ

---

## üìû Besoin d'aide ?

Si vous bloquez √† une √©tape :
1. Notez le num√©ro de l'√©tape (ex: "Je bloque √† 3.4")
2. Faites une capture d'√©cran si possible
3. Dites-moi o√π vous √™tes bloqu√©

Je vous aiderai √† d√©bloquer la situation ! üöÄ

---

## üéä Prochaine √âtape

Une fois que vous avez A+, pensez √† :
- Tester toutes les pages de votre site
- V√©rifier que la carte Leaflet fonctionne toujours
- V√©rifier que le formulaire de contact fonctionne
- Faire une nouvelle vid√©o TikTok avec le score A+ ! üòé
